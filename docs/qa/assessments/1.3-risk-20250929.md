# Risk Profile – Story 1.3 Guided Onboarding & Template Library

- **Story ID:** 1.3
- **Story Title:** Guided Onboarding & Template Library
- **Story Slug:** guided-onboarding-template-library
- **Assessment Date:** 2025-09-29
- **Assessor:** Quinn (QA)
- **Overall Story Risk Score:** 60 / 100 (Moderate)

## Summary
New onboarding checklist, template library, education hub, and analytics stream introduce cross-cutting concerns across frontend, backend, compliance, and observability. The most significant risks cluster around compliance messaging, sanitized content rendering, analytics reliability, and bundle/performance impact. Coordinated mitigations across shared contracts, persistence patterns, and monitoring are required.

## Risk Matrix

| Risk ID  | Description                                                                 | Probability | Impact     | Score | Priority |
| -------- | --------------------------------------------------------------------------- | ----------- | ---------- | ----- | -------- |
| BUS-001  | Compliance disclaimers or education copy drift from approved messaging      | Medium (2)  | High (3)   | 6     | High     |
| SEC-001  | Unsanitized education hub or tooltip content enables script injection       | Medium (2)  | High (3)   | 6     | High     |
| PERF-001 | Guided onboarding resources inflate dashboard bundle and degrade load time  | High (3)    | Medium (2) | 6     | High     |
| DATA-001 | Onboarding analytics events missing/duplicated leading to unreliable KPIs   | Medium (2)  | High (3)   | 6     | High     |
| TECH-001 | Persisted checklist state desynchronizes across sessions/devices            | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-001  | Monitoring gaps hide onboarding regressions post-deploy                     | Medium (2)  | Medium (2) | 4     | Medium   |

## Category Coverage
- **Technical:** 1 medium
- **Security:** 1 high
- **Performance:** 1 high
- **Data:** 1 high
- **Business:** 1 high
- **Operational:** 1 medium

## Detailed Risk Register

| Risk ID | Category    | Description | Affected Components | Detection Method | Probability | Impact | Score | Priority | Mitigation Strategy | Residual Risk |
| ------- | ----------- | ----------- | ------------------- | ---------------- | ----------- | ------ | ----- | -------- | ------------------- | ------------- |
| BUS-001 | Business    | Approved disclaimers/tooltips might diverge when template metadata updates lag behind compliance reviews, exposing regulatory risk. | Template library UI, shared template metadata, compliance hooks | Requirements review, copy QA, compliance sign-off checklist | Medium (2) | High (3) | 6 | High | Drive disclaimers from `TemplateShare` contracts, add CI check ensuring required fields populated, enforce compliance approval workflow before publish. | Low once automation in place |
| SEC-001 | Security    | Rich education hub/media content rendered without sanitization could enable XSS through CMS-managed copy. | Education hub panels, tooltip rendering, shared content helpers | Static analysis, security linting, penetration testing | Medium (2) | High (3) | 6 | High | Render approved Markdown via trusted renderer, strip unsafe HTML, add unit tests for sanitization, run ZAP scan on onboarding routes. | Medium (2×2=4) pending verification |
| PERF-001 | Performance | Additional onboarding components, media, and analytics scripts inflate bundle size and block dashboard interactivity. | Next.js dashboard route, onboarding components, asset loaders | Lighthouse/Next.js bundle analyzer | High (3) | Medium (2) | 6 | High | Code-split onboarding flow, lazy-load media, cache templates, add performance budget checks in CI using `next build --analyze`. | Medium if budgets enforced |
| DATA-001 | Data        | Analytics events may fail to emit or deduplicate, breaking activation funnel metrics. | Onboarding checklist instrumentation, FastAPI analytics services, Timescale ingestion | Unit/integration tests, analytics dashboard validation | Medium (2) | High (3) | 6 | High | Implement contract tests for `/templates` and analytics ingestion, add retries + idempotent IDs, monitor event counts vs baseline, verify via staging dashboards pre-launch. | Medium until live telemetry verified |
| TECH-001 | Technical   | Zustand `persist` store for onboarding checklist may desync when multiple tabs or server resets occur, leading to inconsistent progress UI. | Zustand store, onboarding checklist UI, server hydration boundaries | Automated component tests, manual multi-session QA | Medium (2) | Medium (2) | 4 | Medium | Centralize store hydration, namespace persist keys per user, add tests for hydration + reconciliation, document edge cases. | Low once store changes validated |
| OPS-001 | Operational  | Lacking dashboards/alerts for onboarding KPIs can delay detection of regressions or backend ingestion failures. | Observability stack (Vercel Analytics, Sentry, Datadog), runbooks | Monitoring reviews, ops readiness checklist | Medium (2) | Medium (2) | 4 | Medium | Create activation KPI dashboard, set SLO alerts for event throughput, document rollback + feature flag plan, update runbook. | Medium until alerts live |

## Risk-Based Testing Strategy

### Priority 1 – Critical Focus (High Score ≥ 6)
- **BUS-001:** Regression tests verifying disclaimers/tooltips render compliant copy from shared contracts; snapshot tests for metadata schema; QA sign-off checklist prior to release.
- **SEC-001:** Security-focused unit/integration tests to confirm sanitized rendering; dynamic scanning of onboarding routes; negative tests with malicious payload fixtures.
- **PERF-001:** Performance regression testing with Lighthouse/Next.js metrics; verify lazy loading and code splitting; stress test with low-bandwidth profiles.
- **DATA-001:** Contract tests ensuring analytics events fire with correct schema; integration tests for FastAPI ingestion; end-to-end Playwright flow validating event emission hooks.

### Priority 2 – Secondary Focus (Score = 4)
- **TECH-001:** Unit tests for persisted store hydration, multi-tab synchronization tests, Playwright scenarios toggling steps across sessions.
- **OPS-001:** Monitoring smoke tests ensuring dashboards/alerts fire; runbook tabletop exercise to simulate ingestion outage.

### Priority 3 – Regression Baseline
- Full functional regression of onboarding flows, template selection, compliance hooks, and analytics dashboards; ensure existing canvas functionality unaffected.

## Development Focus Recommendations
- Pair engineering with compliance early to align template metadata and disclaimers.
- Implement centralized content sanitization utilities shared across onboarding/education modules.
- Integrate bundle analyzer into CI to prevent regressions.
- Adopt event schema validation at both client and FastAPI layers.

## Deployment & Rollout Guidance
- Deploy behind feature flag for controlled exposure; enable gradual rollout per cohort.
- Maintain rollback plan for onboarding modules with documented steps.
- Ensure compliance approvals documented prior to enabling production flag.

## Monitoring Requirements
- Create activation KPI dashboard tracking funnel completion, template selections, and event throughput.
- Configure alerts for sudden drops in onboarding event counts, sanitization errors, or performance regressions.
- Capture Sentry breadcrumbs for onboarding steps to aid incident triage.

## Risk Acceptance Criteria
- Block release until BUS-001, SEC-001, PERF-001, and DATA-001 mitigations validated.
- TECH-001 and OPS-001 acceptable with mitigation plus monitoring commitments.
- Document any residual medium risks with owner sign-off if shipping under mitigation.

## Risk Review Triggers
- Any change to template metadata schema or compliance requirements.
- Introduction of new education content sources or CMS integrations.
- Significant adjustments to analytics stack or ingestion pathways.
- Performance budget breaches detected in CI or production telemetry.

---

Overall scoring deductions: High (x4) = -40, Medium (x2) = -10 → Final Score 60.
