# Test Design: Story 1.3 Guided Onboarding & Template Library

Date: 2025-09-29
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 16
- Unit tests: 5 (31%)
- Integration tests: 7 (44%)
- E2E tests: 4 (25%)
- Priority distribution: P0: 10, P1: 6, P2: 0, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1: Guided checklist highlights onboarding steps with progress tracking

| ID            | Level       | Priority | Test                                                                 | Justification                                                                                   | Mitigates Risks |
| ------------- | ----------- | -------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | --------------- |
| 1.3-UNIT-001  | Unit        | P1       | Validate checklist reducer step transitions and branching logic     | Core state machine logic can be isolated for fast feedback                                        | TECH-001        |
| 1.3-UNIT-002  | Unit        | P1       | Verify Zustand `persist` config namespaces per user and hydrates    | Ensures persistence keys remain scoped and rehydration works without IO side effects             | TECH-001        |
| 1.3-INT-001   | Integration | P1       | SSR/CSR hydration test for dashboard shell mounting persisted state | Validates hydration boundary and ensures progress survives refresh/session restoration           | TECH-001        |
| 1.3-E2E-001   | E2E         | P0       | Guided onboarding journey from canvas tour through first backtest   | Critical activation path; verifies checklist UI, persistence, and instrumentation end-to-end     | TECH-001, DATA-001 |

### AC2: Template library offers starter strategies with annotated tooltips

| ID            | Level       | Priority | Test                                                                     | Justification                                                                                           | Mitigates Risks |
| ------------- | ----------- | -------- | ------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------- | --------------- |
| 1.3-UNIT-003  | Unit        | P0       | Ensure `TemplateShare` metadata schema requires disclaimers/tooltips     | Protects compliance-critical copy and enforces presence via shared contract validation                   | BUS-001         |
| 1.3-INT-002   | Integration | P0       | Service call from dashboard to `/templates` returns compliant metadata   | Confirms shared API client + backend contract supply disclaimers consistently                            | BUS-001, DATA-001 |
| 1.3-E2E-002   | E2E         | P1       | User loads template library route, sees tooltip metadata and clones      | UI-level confirmation that annotated templates render and block definitions remain in sync               | BUS-001         |

### AC3: Education hub surfaces compliant copy/media with disclosures

| ID            | Level       | Priority | Test                                                                 | Justification                                                                                  | Mitigates Risks |
| ------------- | ----------- | -------- | -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- | --------------- |
| 1.3-UNIT-004  | Unit        | P0       | Sanitize rendered education hub/tooltip content against malicious HTML | Guards against XSS by testing centralized sanitization utilities with malicious payload fixtures | SEC-001         |
| 1.3-INT-003   | Integration | P0       | Compliance audit hook fires when education content/templates updated | Ensures operational logging + approvals execute when regulated copy changes                      | BUS-001, OPS-001 |
| 1.3-E2E-003   | E2E         | P1       | Responsive education drawer displays disclosures across breakpoints   | Confirms UX requirements and verifies disclosure visibility for end users                        | BUS-001         |

### AC4: Analytics event stream captures onboarding progress

| ID            | Level       | Priority | Test                                                                          | Justification                                                                                           | Mitigates Risks |
| ------------- | ----------- | -------- | ----------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | --------------- |
| 1.3-UNIT-005  | Unit        | P0       | Event builder formats payload with step IDs, timestamps, outcomes             | Pure logic; protects schema integrity and minimizes duplication errors                                   | DATA-001        |
| 1.3-INT-004   | Integration | P0       | Client-side analytics emitter posts events via shared instrumentation adapters | Validates instrumentation stack wiring (Vercel Analytics/Sentry) and ensures retries/idempotency         | DATA-001        |
| 1.3-INT-005   | Integration | P0       | FastAPI analytics router persists onboarding events idempotently to Timescale | Confirms backend pipeline, deduplication, and storage; critical for KPI accuracy                        | DATA-001        |
| 1.3-E2E-004   | E2E         | P0       | Playwright flow asserts emission/receipt of key onboarding analytics events   | Full-stack confirmation that UI actions create expected telemetry (with analytics intercept assertions)  | DATA-001, OPS-001 |

### Cross-Cutting Risk Mitigation

| ID            | Level       | Priority | Test                                                                      | Justification                                                                                  | Mitigates Risks |
| ------------- | ----------- | -------- | ------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- | --------------- |
| 1.3-INT-006   | Integration | P0       | Performance budget check using `next build --analyze` for onboarding bundle | Protects dashboard load times by enforcing code-splitting/lazy loading thresholds               | PERF-001        |
| 1.3-INT-007   | Integration | P1       | Monitoring pipeline smoke test validates dashboard/alert wiring            | Ensures onboarding KPIs feed dashboards and alerts trigger on ingestion regressions             | OPS-001         |

## Risk Coverage

| Risk ID  | Covered By                                                                                               | Residual Notes |
| -------- | -------------------------------------------------------------------------------------------------------- | -------------- |
| BUS-001  | 1.3-UNIT-003, 1.3-INT-002, 1.3-INT-003, 1.3-E2E-002, 1.3-E2E-003                                         | Residual low once automation passes |
| SEC-001  | 1.3-UNIT-004                                                                                            | Residual medium until ZAP scan executed |
| PERF-001 | 1.3-INT-006, 1.3-E2E-001                                                                                | Requires CI integration of analyzer |
| DATA-001 | 1.3-E2E-001, 1.3-UNIT-005, 1.3-INT-002, 1.3-INT-004, 1.3-INT-005, 1.3-E2E-004                             | Monitor staging telemetry post-deploy |
| TECH-001 | 1.3-UNIT-001, 1.3-UNIT-002, 1.3-INT-001, 1.3-E2E-001                                                     | Residual low with multi-tab manual QA |
| OPS-001  | 1.3-INT-003, 1.3-E2E-004, 1.3-INT-007                                                                     | Formalize runbook updates |

## Recommended Execution Order

1. P0 Unit tests – 1.3-UNIT-003, 1.3-UNIT-004, 1.3-UNIT-005
2. P0 Integration tests – 1.3-INT-002, 1.3-INT-003, 1.3-INT-004, 1.3-INT-005, 1.3-INT-006
3. P0 E2E tests – 1.3-E2E-001, 1.3-E2E-004
4. Remaining P1 Unit/Integration tests – 1.3-UNIT-001, 1.3-UNIT-002, 1.3-INT-001, 1.3-INT-007
5. P1 E2E scenarios – 1.3-E2E-002, 1.3-E2E-003

## Gate Block

```yaml
test_design:
  scenarios_total: 16
  by_level:
    unit: 5
    integration: 7
    e2e: 4
  by_priority:
    p0: 10
    p1: 6
    p2: 0
    p3: 0
  coverage_gaps: []
```

## Trace References

Test design matrix: qa/assessments/1.3-test-design-20250929.md
P0 tests identified: 10
