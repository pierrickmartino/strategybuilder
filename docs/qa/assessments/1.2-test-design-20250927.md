# Test Design: Story 1.2 â€“ Core Canvas Blocks & Validation

Date: 2025-09-27
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 16
- Unit tests: 5 (31%)
- Integration tests: 6 (38%)
- E2E tests: 5 (31%)
- Priority distribution: P0: 9, P1: 6, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Canvas supports drag-and-drop, linking, deletion, undo (five starter blocks)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-001 | Unit | P0 | Validate shared block schema contracts for starter blocks | Guarantees UI/API alignment and blocks malformed graphs (mitigates TECH-002, SEC-003) |
| 1.2-UNIT-002 | Unit | P0 | Verify undo stack reducer handles add/link/delete operations idempotently | Ensures deterministic state transitions before wiring UI (mitigates TECH-002) |
| 1.2-INT-001 | Integration | P0 | Simulate drag/link/delete via canvas store and persist graph to mocked API | Validates cross-layer synchronization between UI state and persistence (mitigates TECH-002, DATA-002) |
| 1.2-E2E-001 | E2E | P1 | User drags five block types, links them, deletes, and performs undo/redo in browser | Confirms full journey, visual correctness, and undo guarantee against regressions (mitigates TECH-002) |

### AC2: Inline validation with real-time feedback (missing inputs, incompatible links, quota)

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-003 | Unit | P0 | Map backend validation payloads to UI badges and toast messaging | Keeps translation logic deterministic and cheap to maintain (mitigates TECH-002, SEC-003) |
| 1.2-INT-002 | Integration | P0 | Execute FastAPI validation pipeline against graph fixtures for missing inputs, incompatible links, quota breaches | Covers server-side enforcement to stop malformed graphs (mitigates SEC-003) |
| 1.2-INT-006 | Integration | P1 | Load-test validation endpoint with bursty graph mutations to ensure batching and throttling limits | Measures performance sensitivity and guards against UX stalls (mitigates PERF-002) |
| 1.2-E2E-002 | E2E | P0 | User creates invalid connection and sees inline badge plus persisted error blocking save | Validates end-to-end compliance signal and prevents invalid state leakage (mitigates SEC-003) |

### AC3: Block configuration side panel with hint text and defaults

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-004 | Unit | P1 | Ensure block configuration schema exposes defaults, ranges, and accessibility hints | Keeps metadata complete and accessible for UI rendering |
| 1.2-INT-003 | Integration | P1 | Validate Zustand store + React Query sync when editing parameters and persisting to API | Confirms bi-directional data flow stays consistent (mitigates TECH-002) |
| 1.2-E2E-003 | E2E | P1 | User edits block parameter, sees hint text, and observes persisted value on refresh | Covers primary UX promise and ensures hydration remains stable |

### AC4: Autosave strategy versions with revert history

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-005 | Unit | P0 | Test autosave scheduler debounce, batching, and failure callbacks | Prevents runaway saves and surfaces errors early (mitigates DATA-002, OPS-002, PERF-002) |
| 1.2-INT-004 | Integration | P0 | Verify version creation API enforces optimistic locking/version tokens and records audit metadata | Stops stale overwrites and preserves compliance trail (mitigates DATA-002) |
| 1.2-INT-005 | Integration | P2 | Confirm history pruning rules keep significant versions and drop noise | Manages operational noise and storage growth (mitigates OPS-002) |
| 1.2-E2E-004 | E2E | P0 | User makes rapid edits, autosave runs, and revert restores earlier snapshot | Protects against data loss and proves revert path (mitigates DATA-002) |
| 1.2-E2E-005 | E2E | P1 | Simulate autosave failure (network drop) and ensure UI surfaces retry plus manual save safety | Ensures graceful degradation and user awareness (mitigates DATA-002, OPS-002) |

## Risk Coverage

| Risk ID | Covered By |
|---------|------------|
| TECH-002 | 1.2-UNIT-001, 1.2-UNIT-002, 1.2-INT-001, 1.2-INT-003, 1.2-E2E-001 |
| DATA-002 | 1.2-INT-001, 1.2-UNIT-005, 1.2-INT-004, 1.2-E2E-004, 1.2-E2E-005 |
| PERF-002 | 1.2-INT-006, 1.2-UNIT-005 |
| SEC-003 | 1.2-UNIT-001, 1.2-UNIT-003, 1.2-INT-002, 1.2-E2E-002 |
| OPS-002 | 1.2-UNIT-005, 1.2-INT-005, 1.2-E2E-005 |

## Recommended Execution Order

1. P0 unit tests (1.2-UNIT-001, 1.2-UNIT-002, 1.2-UNIT-003, 1.2-UNIT-005)
2. P0 integration tests (1.2-INT-001, 1.2-INT-002, 1.2-INT-004)
3. P0 E2E tests (1.2-E2E-002, 1.2-E2E-004)
4. Remaining P1 tests in decreasing scope (integration, then E2E)
5. P2 operational regression (1.2-INT-005) as part of release hardening

---
Test design matrix: docs/qa/assessments/1.2-test-design-20250927.md
P0 tests identified: 9
