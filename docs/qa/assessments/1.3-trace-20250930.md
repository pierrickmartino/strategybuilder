# Requirements Traceability Matrix

## Story: 1.3 - Guided Onboarding & Template Library

### Coverage Summary
- Total Requirements: 4
- Fully Covered: 2 (50%)
- Partially Covered: 2 (50%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: Guided checklist highlights onboarding steps (tour canvas, load template, run backtest) with progress tracking.
**Coverage: FULL**
- test_file: `apps/web/tests/integration/OnboardingChecklist.test.tsx`
  test_case: "renders steps and updates progress when marking complete"
  given: Onboarding checklist rendered with default Zustand store state
  when: User clicks the control to mark "Tour the canvas" as complete
  then: Progress indicator advances to 1/3 · 33% and the store records the step as completed
  coverage: integration
- test_file: `apps/web/tests/unit/onboardingProgress.test.ts`
  test_case: "marks a step complete and enqueues analytics event"
  given: Onboarding progress store initialised with default steps
  when: Invoking `markStep` for `tour-canvas` with status `completed`
  then: Step state flips to completed and a telemetry payload is queued
  coverage: unit

#### AC2: Template library offers at least three pre-built strategies with tooltips explaining each block.
**Coverage: PARTIAL**
- test_file: `tests/e2e/onboarding.spec.ts`
  test_case: "should create audit trail entries after completing onboarding"
  given: Newly provisioned builder user exercising onboarding APIs
  when: Calling `/templates` through the authenticated Playwright request context and recording visibility events
  then: Response returns ≥3 templates and a `template.visibility` compliance event persists with the count
  coverage: e2e
- test_file: `apps/api/tests/test_onboarding_features.py`
  test_case: "test_template_library_emits_compliance_event"
  given: In-memory database session with synced user and seeded template catalog
  when: Fetching the onboarding template library and recording template visibility for each entry
  then: Compliance events table stores a `template.visibility` record reflecting the template count
  coverage: integration

#### AC3: In-app education hub surfaces copy, video, or tooltip content that clarifies simulation scope and risk disclaimers.
**Coverage: PARTIAL**
- test_file: `tests/e2e/onboarding.spec.ts`
  test_case: "should create audit trail entries after completing onboarding"
  given: Authenticated onboarding workflow executed through Playwright request utilities
  when: Requesting `/education/onboarding` and recording delivery for returned panels
  then: API response includes at least one panel and a `education.delivery` compliance event is stored
  coverage: e2e
- test_file: `apps/api/tests/test_onboarding_features.py`
  test_case: "test_education_delivery_captured_for_audit"
  given: Async SQLAlchemy session with synchronised onboarding user
  when: Loading onboarding education content and recording delivery metadata
  then: Compliance events persistence captures the delivery with panel count metadata
  coverage: integration

#### AC4: Analytics event stream captures onboarding progress to measure activation metrics.
**Coverage: FULL**
- test_file: `apps/web/tests/unit/onboardingProgress.test.ts`
  test_case: "marks a step complete and enqueues analytics event"
  given: Default onboarding progress store state
  when: Completing the `tour-canvas` step and draining queued events
  then: Pending events queue reflects the completion payload and drains/requeues correctly
  coverage: unit
- test_file: `apps/web/tests/unit/onboardingProgress.test.ts`
  test_case: "drains queued events"
  given: Store with multiple completed steps enqueued for delivery
  when: Invoking `drainEvents`
  then: All queued analytics payloads are returned and pending queue is cleared
  coverage: unit
- test_file: `apps/api/tests/test_onboarding_features.py`
  test_case: "test_record_onboarding_events_persists_payload"
  given: Persisted onboarding user and analytics payload targeting `tour-canvas`
  when: Recording onboarding analytics events through the service layer
  then: Database row stores the step identifier, status, and template metadata
  coverage: integration
- test_file: `tests/e2e/onboarding.spec.ts`
  test_case: "should create audit trail entries after completing onboarding"
  given: Authenticated onboarding flow executed with Playwright request context
  when: Posting analytics completion events to `/analytics/onboarding`
  then: Endpoint returns 202 Accepted and persisted record matches the submitted payload
  coverage: e2e

### Critical Gaps
1. Template library UI lacks automated verification for tooltip text, disclaimer rendering, and checklist progression when a template is selected (AC2).
2. Education hub UI has no tests confirming compliance tag visibility, resource link rendering, or error-state messaging (AC3).

### Test Design Recommendations
1. Add React Testing Library coverage for `TemplateLibrary` to assert block tooltip titles, disclaimers, and markStep side effects.
2. Introduce component/integration tests for `EducationHub` that validate copy, media link surfacing, compliance tags, and fallback messaging.
3. Extend e2e coverage to walkthrough the dashboard template selection and education hub panels to correlate UI interactions with compliance/analytics events.

### Risk Assessment
- Medium Risk: Missing template tooltip/disclaimer assertions could allow regressions that hide critical onboarding guidance (AC2).
- Medium Risk: Lack of education hub UI coverage risks shipping incomplete compliance messaging or broken resource links (AC3).
- Low Risk: Analytics telemetry paths are well covered; residual risk stems mainly from UI presentation gaps.

Trace matrix: docs/qa/assessments/1.3-trace-20250930.md
