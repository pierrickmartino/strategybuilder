# Story 1.3: Guided Onboarding & Template Library

## Status
Draft

## Story
**As a** first-time user,
**I want** a guided walkthrough and starter strategies,
**so that** I can run my first successful backtest within minutes.

## Acceptance Criteria
1. Guided checklist highlights onboarding steps (tour canvas, load template, run backtest) with progress tracking.
2. Template library offers at least three pre-built strategies with tooltips explaining each block.
3. In-app education hub surfaces copy, video, or tooltip content that clarifies simulation scope and risk disclaimers.
4. Analytics event stream captures onboarding progress to measure activation metrics.

## Tasks / Subtasks
- [ ] Deliver guided onboarding checklist with progress persistence (AC: 1)
  - [ ] Introduce an onboarding progress store with Zustand `persist` to track step completion across sessions per state management guidance. (AC: 1) [Source: architecture/frontend-architecture.md#state-management-patterns]
  - [ ] Build checklist components under `apps/web/src/components/onboarding` with accessible progress indicators that follow the documented component hierarchy. (AC: 1) [Source: architecture/frontend-architecture.md#component-architecture]
  - [ ] Mount the checklist within the dashboard shell so it walks users through canvas tour, template load, and backtest steps defined in the core workflow diagram. (AC: 1) [Source: architecture/core-workflows.md#core-workflows]
- [ ] Ship template library with annotated starter strategies (AC: 2)
  - [ ] Add a dashboard templates route that respects the App Router organization for authenticated experiences. (AC: 2) [Source: architecture/frontend-architecture.md#routing-architecture]
  - [ ] Implement a service in `apps/web/src/services` that consumes the `/templates` endpoint via the shared API client pattern. (AC: 2) [Source: architecture/frontend-architecture.md#frontend-services-layer]
  - [ ] Populate template cards with metadata and disclaimers sourced from shared contracts so tooltips explain each block. (AC: 2) [Source: architecture/data-models.md#templateshare]
  - [ ] Surface shared block definitions through `packages/shared` to keep UI and API schemas consistent when rendering starter strategies. (AC: 2) [Source: architecture/coding-standards.md#critical-fullstack-rules]
- [ ] Launch education hub content with compliance messaging (AC: 3)
  - [ ] Compose education hub panels within the onboarding module using responsive drawer behavior for tablet/mobile. (AC: 3) [Source: architecture/frontend-architecture.md#responsive-accessibility-strategy]
  - [ ] Include simulation scope copy, disclaimers, and media sourced from the documented education suite while honoring compliance review hooks. (AC: 3) [Source: architecture/deployment-architecture.md#operational-playbooks--responsibilities]
  - [ ] Invoke compliance auditing helpers when updating template visibility or education assets so disclosures stay logged. (AC: 3) [Source: architecture/coding-standards.md#critical-fullstack-rules]
- [ ] Instrument onboarding analytics stream (AC: 4)
  - [ ] Emit analytics events for each checklist milestone via the documented Vercel Analytics and Sentry instrumentation stack. (AC: 4) [Source: architecture/monitoring-and-observability.md#monitoring-stack]
  - [ ] Tag events with step IDs, timestamps, and completion outcomes so activation dashboards can compute funnel metrics. (AC: 4) [Source: architecture/monitoring-and-observability.md#key-metrics]
  - [ ] Forward server-side events or counters through FastAPI services using the standard router/service layering to keep data in Supabase/Timescale. (AC: 4) [Source: architecture/backend-architecture.md#controller-template]
- [ ] Extend automated coverage for onboarding flows (AC: 1,2,3,4)
  - [ ] Add frontend unit and integration tests for checklist state, template tooltips, and education hub interactions in the prescribed directories. (AC: 1,2,3) [Source: architecture/testing-strategy.md#frontend]
  - [ ] Add backend tests that validate analytics event ingestion and template metadata delivery. (AC: 2,4) [Source: architecture/testing-strategy.md#backend]
  - [ ] Update Playwright onboarding journey to assert progress tracking, template selection, and analytics emission hooks. (AC: 1,2,4) [Source: architecture/testing-strategy.md#e2e]
  - [ ] Wire new tests into existing npm/poetry commands so CI mirrors local execution. (AC: 1,2,3,4) [Source: architecture/development-workflow.md#development-commands]

## Dev Notes
### Previous Story Insights
- Canvas and onboarding flows should continue leveraging the shared Zustand store pattern established by the canvas implementation for consistent hydration and undo semantics. [Source: architecture/frontend-architecture.md#state-management-architecture]
- UI enhancements belong under the documented Next.js component hierarchy so new onboarding modules coexist with existing canvas components. [Source: architecture/frontend-architecture.md#component-architecture]

### Data Models
- Use `TemplateShare` records for published starter strategies, including `metadata` fields for block descriptions, disclaimers, and clone counts. [Source: architecture/data-models.md#templateshare]
- `Strategy` and `StrategyVersion` entities back template selection and initial backtest versions created during onboarding. [Source: architecture/data-models.md#strategy]
- Track backtest outcomes through `BacktestRun` entries so the onboarding flow can confirm successful simulations. [Source: architecture/data-models.md#backtestrun]
- Record analytics counters in Timescale-backed tables managed via FastAPI services to enable activation dashboards. [Source: architecture/database-schema.md#database-schema]

### API Specifications
- Fetch starter templates using the documented `GET /templates` endpoint for anonymous browsing. [Source: architecture/api-specification.md#api-specification]
- Persist initial strategy scaffolds and versions during onboarding via `POST /strategies` and `POST /strategies/{strategyId}/versions`. [Source: architecture/api-specification.md#api-specification]
- Enqueue the user's first backtest with `POST /backtests` once checklist steps reach completion. [Source: architecture/api-specification.md#api-specification]

### Component Specifications
- Onboarding, analytics, and education components should live under `apps/web/src/components/{onboarding|analytics}` per the feature module breakdown. [Source: architecture/frontend-architecture.md#feature-modules]
- Follow responsive + accessibility conventions (focus rings, drawers, live regions) when presenting checklist progress and tooltips. [Source: architecture/frontend-architecture.md#responsive-accessibility-strategy]
- Service hooks must wrap the shared Ky client so Supabase tokens flow automatically for authenticated steps. [Source: architecture/frontend-architecture.md#frontend-services-layer]

### File Locations
- Place new UI under `apps/web/src/app/(dashboard)/[locale]` routes and companion components in `apps/web/src/components`. [Source: architecture/frontend-architecture.md#component-architecture]
- Persist shared template definitions or analytics contracts in `packages/shared` to keep UI/API alignment. [Source: architecture/unified-project-structure.md#unified-project-structure]
- House FastAPI analytics routers and services within `apps/api/src/api/routers` and `apps/api/src/services` following the documented layering. [Source: architecture/backend-architecture.md#controllerroute-organization]

### Project Structure Notes
- The monorepo layout mandates apps under `apps/` and shared contracts under `packages/`; onboarding additions must respect this structure to avoid drift. [Source: architecture/unified-project-structure.md#unified-project-structure]
- No structural conflicts detectedâ€”new directories such as `components/onboarding` extend documented feature groupings. [Source: architecture/frontend-architecture.md#feature-modules]

### Testing Requirements
- Frontend unit tests belong in `apps/web/tests/unit` with integration flows in `apps/web/tests/integration`. [Source: architecture/testing-strategy.md#frontend]
- Backend analytics ingestion tests should land in `apps/api/tests/unit` or `apps/api/tests/integration` according to scope. [Source: architecture/testing-strategy.md#backend]
- End-to-end coverage for onboarding lives in `tests/e2e`, extending the existing `onboarding.spec.ts`. [Source: architecture/testing-strategy.md#e2e]

### Technical Constraints
- Frontend leverages Next.js 15, React Query, Zustand, and Radix UI primitives; backend uses FastAPI with async patterns throughout. [Source: architecture/tech-stack.md#tech-stack]
- Shared contracts must stay in `packages/shared`, and compliance hooks should guard template visibility changes. [Source: architecture/coding-standards.md#critical-fullstack-rules]
- Follow CSP, storage, and validation requirements when embedding media and handling onboarding form inputs. [Source: architecture/security-and-performance.md#security-requirements]
- Emit analytics through the approved observability stack (Vercel Analytics, Sentry, Datadog) to satisfy activation reporting KPIs. [Source: architecture/monitoring-and-observability.md#monitoring-stack]

### Testing
- Run `pnpm turbo run test` for web suites and `poetry run pytest apps/api` to mirror CI expectations. [Source: architecture/development-workflow.md#development-commands]
- Execute Playwright onboarding scenarios under `tests/e2e` after wiring new steps to confirm guided flow and analytics hooks. [Source: architecture/testing-strategy.md#e2e]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-30 | v0.1 | Initial draft outlining onboarding checklist, template library, education hub, and analytics instrumentation. | Scrum Master |

## Dev Agent Record
### Agent Model Used

- _TBD_

### Debug Log References

- _TBD_

### Completion Notes List

- _TBD_

### File List

- _TBD_

## QA Results
- _TBD_
